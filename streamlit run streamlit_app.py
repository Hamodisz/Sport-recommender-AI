import streamlit as st
import openai
import os

# --- واجهة اختيار اللغة ---
st.set_page_config(page_title="توصية الرياضة المناسبة", layout="centered")
st.title("🤖 نظام التوصية الرياضية الذكي")

language = st.radio("🌐 اختر اللغة / Choose Language:", ("العربية", "English"))

# --- إدخال مفتاح OpenAI ---
api_key = st.text_input("🔐 أدخل مفتاح OpenAI الخاص بك / Enter your OpenAI API key", type="password")
if not api_key:
    st.stop()
openai.api_key = api_key

# --- تحديد الأسئلة والإجابات حسب اللغة ---
if language == "العربية":
    questions = [
        "كيف تبدأ يومك غالبًا؟",
        "ما نوع الأنشطة التي تجعلك تنسى الوقت؟",
        "كيف كان تفاعلك مع الحصص الرياضية في المدرسة؟",
        "كيف تتعامل مع الضغط أو التوتر؟",
        "كيف تحب قضاء عطلة نهاية الأسبوع؟",
        "ما أكثر بيئة تفضّل فيها قضاء وقت فراغك؟",
        "إذا طُلب منك تجربة رياضة جديدة، ما أول ما تفكر فيه؟",
        "في طفولتك، ما نوع الألعاب التي كنت تفضلها؟",
        "كيف تصف علاقتك مع المخاطرة؟",
        "ما نوع الأنشطة التي تعطيك إحساس بالإنجاز؟",
        "كيف تتعامل مع الفشل أو الخسارة؟",
        "ما الذي يجذبك في أي نشاط جديد؟",
        "ما أكثر شيء يُحفّزك للاستمرار في ممارسة نشاط؟",
        "أي نوع من التعبير يناسبك أكثر؟",
        "ما أكثر ما تبحث عنه في أي رياضة أو نشاط؟",
        "أي من التالي أقرب لنمط حياتك اليومي؟",
        "عندما تتعلم مهارة جديدة، كيف تفضّل ذلك؟",
        "أي وصف أقرب لطبيعتك اليومية؟",
        "ما الذي يجعلك تترك ممارسة رياضة معينة؟",
        "لو كان بإمكانك تصميم رياضة خاصة بك، كيف ستكون؟"
    ]

    options = [
        ["أ) أبدأ مباشرة بنشاط جسدي", "ب) أحتاج بعض الوقت", "ج) أرتب أفكاري", "د) لا روتين", "هـ) لا شيء مما سبق"],
        ["أ) حركة وتحدي", "ب) تفاعل جماعي", "ج) ألغاز ذهنية", "د) استرخاء", "هـ) لا شيء مما سبق"],
        ["أ) متحمس دائمًا", "ب) حسب النشاط", "ج) لا أرتاح لها", "د) أتهرب", "هـ) لا شيء مما سبق"],
        ["أ) أتحرك", "ب) أتكلم مع أحد", "ج) أقرأ", "د) أنعزل", "هـ) لا شيء مما سبق"],
        ["أ) مغامرات", "ب) اجتماعي", "ج) تخطيط", "د) راحة منزلية", "هـ) لا شيء مما سبق"],
        ["أ) طبيعة", "ب) أماكن مزدحمة", "ج) بيت أو مكتب", "د) حسب المزاج", "هـ) لا شيء مما سبق"],
        ["أ) حماس وتحدي", "ب) من معي؟", "ج) فائدتها", "د) أمانها", "هـ) لا شيء مما سبق"],
        ["أ) ألعاب حركية", "ب) تنافسية", "ج) فكرية", "د) خيالية", "هـ) لا شيء مما سبق"],
        ["أ) أحب المخاطرة", "ب) أوازن", "ج) حذر", "د) أتهرب", "هـ) لا شيء مما سبق"],
        ["أ) إنجاز بدني", "ب) إنجاز جماعي", "ج) إنجاز ذهني", "د) داخلي", "هـ) لا شيء مما سبق"],
        ["أ) أعود بقوة", "ب) أتكلم", "ج) أراجع بهدوء", "د) أبتعد", "هـ) لا شيء مما سبق"],
        ["أ) التحدي", "ب) التفاعل", "ج) الفكرة", "د) البساطة", "هـ) لا شيء مما سبق"],
        ["أ) تطور جسدي", "ب) بيئة مشجعة", "ج) شعور داخلي", "د) ما أمل", "هـ) لا شيء مما سبق"],
        ["أ) جسدي", "ب) اجتماعي", "ج) كتابي", "د) فني", "هـ) لا شيء مما سبق"],
        ["أ) تحدي ونتائج", "ب) متعة وتواصل", "ج) تطوير ذاتي", "د) استرخاء", "هـ) لا شيء مما سبق"],
        ["أ) كثير حركة", "ب) تفاعل اجتماعي", "ج) مهام ذهنية", "د) هدوء", "هـ) لا شيء مما سبق"],
        ["أ) بالتجربة", "ب) التفاعل", "ج) الفهم أولاً", "د) الملاحظة", "هـ) لا شيء مما سبق"],
        ["أ) سريع، حركي", "ب) اجتماعي", "ج) دقيق وملاحظ", "د) متزن", "هـ) لا شيء مما سبق"],
        ["أ) بدون نتائج", "ب) مملة", "ج) غير مفيدة ذهنيًا", "د) ما تناسب وقتي", "هـ) لا شيء مما سبق"],
        ["أ) تحدي ومغامرة", "ب) تفاعل اجتماعي", "ج) تفكير وذكاء", "د) هدوء", "هـ) لا شيء مما سبق"]
    ]
    prompt_intro = "أنت خبير نفسي ورياضي. اقرأ إجابات هذا الشخص واقترح عليه رياضة واحدة تناسبه، واذكر السبب، بالعربية فقط."
else:
    questions = [  # ← اختصار للإنجليزية هنا... نكمل لاحقًا لو حبيت
        "How do you usually start your day?",
        "What kind of activities make you lose track of time?",
        # أكمل حسب الحاجة
    ]
    options = [
        ["A) Physical activity", "B) Need time", "C) Organize thoughts", "D) No routine", "E) None of the above"],
        ["A) Challenge", "B) Socializing", "C) Mental games", "D) Relaxing", "E) None of the above"],
        # أكمل حسب الحاجة
    ]
    prompt_intro = "You are a sports and psychology expert. Read this person's answers and recommend one sport that suits them, in English only."

# --- جمع الإجابات ---
st.markdown("---")
st.subheader("🧠 جاوب على الأسئلة التالية:" if language == "العربية" else "🧠 Answer the following questions:")

answers = []
for i in range(len(questions)):
    st.markdown(f"**{i+1}. {questions[i]}**")
    choice = st.radio(f"", options[i], key=f"q{i}")
    if "هـ" in choice or "E)" in choice:
        other = st.text_input("📝 اكتب إجابتك:", key=f"text_{i}")
        answers.append(other if other else choice)
    else:
        answers.append(choice)

# --- زر التوصية ---
if st.button("🎯 احصل على التوصية الرياضية" if language == "العربية" else "🎯 Get Sport Recommendation"):
    full_input = "\n".join([f"{i+1}. {ans}" for i, ans in enumerate(answers)])

    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[
            {"role": "system", "content": prompt_intro},
            {"role": "user", "content": full_input}
        ]
    )

    st.markdown("---")
    st.subheader("✅ التوصية الرياضية:" if language == "العربية" else "✅ Sport Recommendation:")
    st.success(response['choices'][0]['message']['content'])
